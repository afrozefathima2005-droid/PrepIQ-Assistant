<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PrepIQ - Exam Answer Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .active-topic { background-color: #2b6cb0; color: white; border-right: 4px solid #1a365d; }
        .active-mark { background-color: #2563eb; color: white; border-color: #1e3a8a; }
        .chat-container::-webkit-scrollbar { width: 6px; }
        .chat-container::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
    </style>
</head>
<body class="bg-[#f3f7fa] font-sans text-slate-800">

    <nav class="bg-[#2b6cb0] text-white p-3 px-6 flex justify-between items-center shadow-md">
        <div class="flex items-center gap-3">
            <i class="fas fa-brain text-2xl"></i>
            <h1 class="text-lg font-bold">PrepIQ <span class="font-normal text-sm opacity-80">â€” St. Peter's AI Answer Hub</span></h1>
        </div>
        <div id="status-badge" class="text-[10px] bg-red-500 px-2 py-1 rounded-full uppercase font-bold">Upload Notes to Start</div>
    </nav>

    <main class="container mx-auto p-6 grid grid-cols-12 gap-6">
        <div class="col-span-3 space-y-4">
            <div class="bg-white rounded shadow-sm border">
                <div class="bg-slate-100 p-3 font-bold text-xs text-slate-500 uppercase">Subject</div>
                <div id="topic-list" class="flex flex-col text-sm">
                    <button onclick="setTopic('CCS340')" class="p-3 text-left border-b active-topic">Cyber Security (CCS340)</button>
                    <button onclick="setTopic('CCW331')" class="p-3 text-left border-b">Business Analytics (CCW331)</button>
                    <button onclick="setTopic('CS3691')" class="p-3 text-left border-b">Embedded & IoT (CS3691)</button>
                    <button onclick="setTopic('CCS345')" class="p-3 text-left">Ethics and AI (CCS345)</button>
                </div>
            </div>

            <div class="bg-white rounded shadow-sm border p-4">
                <div class="text-slate-500 font-bold text-xs uppercase mb-3">Target Marks</div>
                <div class="grid grid-cols-3 gap-2">
                    <button onclick="setMarks(2)" id="m2" class="border py-2 text-xs rounded font-bold">2M</button>
                    <button onclick="setMarks(8)" id="m8" class="border py-2 text-xs rounded font-bold">8M</button>
                    <button onclick="setMarks(16)" id="m16" class="border py-2 text-xs rounded font-bold active-mark">16M</button>
                </div>
            </div>

            <div class="bg-white rounded shadow-sm border p-4 text-center">
                <label class="cursor-pointer block bg-blue-50 border-2 border-dashed border-blue-200 p-4 rounded-xl hover:bg-blue-100">
                    <i class="fas fa-file-pdf text-blue-600 mb-2"></i>
                    <span class="block text-[10px] font-bold uppercase">Upload Unit PDF</span>
                    <input type="file" id="pdf-upload" class="hidden" accept="application/pdf">
                </label>
            </div>
        </div>

        <div class="col-span-9 flex flex-col h-[750px] bg-white rounded shadow-lg border overflow-hidden">
            <div id="answer-area" class="flex-1 overflow-y-auto p-8 chat-container bg-white">
                <div id="placeholder" class="text-center py-20 text-slate-300">
                    <i class="fas fa-pen-nib text-6xl mb-4"></i>
                    <p>Enter a question or topic to generate your study answer.</p>
                </div>
                <div id="output-text" class="prose prose-blue max-w-none"></div>
            </div>

            <div class="p-4 border-t bg-slate-50">
                <div class="flex items-center gap-3 bg-white border rounded-xl px-4 py-1 shadow-inner focus-within:ring-2 focus-within:ring-blue-400">
                    <input id="user-query" type="text" placeholder="e.g. Discuss the role of cybercriminals..." class="flex-1 outline-none text-sm py-3">
                    <i class="fas fa-microphone text-slate-400 cursor-pointer hover:text-red-500" onclick="startVoice()"></i>
                    <button onclick="generateAnswer()" class="bg-[#2b6cb0] text-white px-6 py-2 rounded-lg font-bold text-sm">Generate</button>
                </div>
            </div>
        </div>
    </main>

    <script>
        let noteContent = "";
        let selectedMarks = 16;
        let selectedSubject = "CCS340";

        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js';

        // PDF Text Extraction
        document.getElementById('pdf-upload').addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = async function() {
                    const pdf = await pdfjsLib.getDocument(new Uint8Array(this.result)).promise;
                    let text = "";
                    for (let i = 1; i <= pdf.numPages; i++) {
                        const page = await pdf.getPage(i);
                        const content = await page.getTextContent();
                        text += content.items.map(item => item.str).join(" ");
                    }
                    noteContent = text;
                    document.getElementById('status-badge').className = "text-[10px] bg-green-500 px-2 py-1 rounded-full uppercase font-bold";
                    document.getElementById('status-badge').innerText = "Notes Synced Successfully";
                };
                reader.readAsArrayBuffer(file);
            }
        });

        function setMarks(m) {
            selectedMarks = m;
            document.querySelectorAll('[id^="m"]').forEach(btn => btn.classList.remove('active-mark'));
            document.getElementById('m'+m).classList.add('active-mark');
        }

        function setTopic(code) {
            selectedSubject = code;
            document.querySelectorAll('#topic-list button').forEach(b => b.classList.remove('active-topic'));
            event.currentTarget.classList.add('active-topic');
        }

        function generateAnswer() {
            const query = document.getElementById('user-query').value;
            const output = document.getElementById('output-text');
            const placeholder = document.getElementById('placeholder');
            
            if(!query) return;
            placeholder.classList.add('hidden');
            output.innerHTML = `<div class="animate-pulse space-y-4"><div class="h-4 bg-slate-200 rounded w-1/4"></div><div class="h-10 bg-slate-100 rounded"></div><div class="h-32 bg-slate-50 rounded"></div></div>`;

            setTimeout(() => {
                let html = `<h2 class="text-2xl font-bold text-blue-900 border-b pb-2 mb-6">${query}</h2>`;
                
                if (selectedMarks == 2) {
                    html += `<div class="p-4 bg-blue-50 rounded-lg border-l-4 border-blue-600">
                                <p class="font-bold text-blue-800 mb-1">Answer (2 Marks):</p>
                                <p class="text-slate-700">Detailed definition and core purpose of ${query} as identified in ${selectedSubject} notes. Usually consists of 2-3 precise sentences.</p>
                             </div>`;
                } else if (selectedMarks == 8) {
                    html += `<div class="space-y-4">
                                <p class="font-bold">Key Points for ${query}:</p>
                                <ul class="list-disc pl-5 space-y-2 text-slate-700">
                                    <li><b>Classification:</b> Categories found in the uploaded document.</li>
                                    <li><b>Core Features:</b> Technical characteristics relevant to ${selectedSubject}.</li>
                                    <li><b>Role/Impact:</b> Why this concept is critical in the current unit.</li>
                                    <li><b>Example:</b> Real-world application mentioned in your notes.</li>
                                </ul>
                             </div>`;
                } else {
                    html += `<div class="space-y-6">
                                <section>
                                    <h3 class="font-bold text-lg text-slate-800 mb-2">1. Introduction</h3>
                                    <p class="text-slate-600 italic leading-relaxed">Contextual overview of ${query} based on the ${selectedSubject} syllabus content.</p>
                                </section>
                                <section class="bg-slate-50 p-6 rounded-xl border">
                                    <h3 class="font-bold text-slate-800 mb-3 underline">2. Detailed Analysis & Classification</h3>
                                    <div class="grid grid-cols-1 gap-4 text-sm">
                                        <div class="bg-white p-3 rounded shadow-sm border-l-4 border-blue-400"><b>Category A:</b> Explanation extracted from PDF text analysis.</div>
                                        <div class="bg-white p-3 rounded shadow-sm border-l-4 border-blue-400"><b>Category B:</b> Functional details regarding the ${selectedSubject} framework.</div>
                                    </div>
                                </section>
                                <section class="border-2 border-dashed border-slate-200 p-10 rounded-2xl text-center">
                                    <p class="text-slate-400 text-xs font-bold uppercase mb-2">Diagram Requirement</p>
                                    <div class="text-blue-500 font-bold">[Insert Diagram of ${query} here]</div>
                                    <p class="text-slate-400 text-[10px] mt-2 italic">Sketch the flow as per Figure 3.2 in your unit notes.</p>
                                </section>
                                <section class="bg-green-50 p-4 rounded-lg border border-green-100">
                                    <p class="font-bold text-green-800">Conclusion:</p>
                                    <p class="text-sm text-green-700">Exam summary highlighting the significance of ${query}.</p>
                                </section>
                             </div>`;
                }
                output.innerHTML = html;
                window.speechSynthesis.speak(new SpeechSynthesisUtterance(query + " answer generated."));
            }, 1000);
        }

        function startVoice() {
            const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
            recognition.onstart = () => document.querySelector('.fa-microphone').classList.add('text-red-500');
            recognition.onresult = (e) => {
                document.getElementById('user-query').value = e.results[0][0].transcript;
                document.querySelector('.fa-microphone').classList.remove('text-red-500');
            };
            recognition.start();
        }
    </script>
</body>
</html>
