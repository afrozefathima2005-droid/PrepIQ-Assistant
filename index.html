<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PrepIQ - Exam Answer Mode</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .active-sub { background: #1e40af; color: white; border-radius: 8px; font-weight: bold; }
        .mark-active { background: #1e40af; color: white; transform: scale(1.05); box-shadow: 0 5px 15px rgba(30,64,175,0.3); }
        .exam-paper { font-family: 'Georgia', serif; line-height: 1.8; color: #1a202c; text-align: justify; }
        .side-heading { font-weight: 800; color: #2d3748; text-decoration: underline; margin-top: 20px; display: block; text-transform: uppercase; font-size: 0.9rem; }
        .highlight-box { border-left: 5px solid #1e40af; padding: 15px; background: #f8fafc; margin: 15px 0; font-style: italic; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">

    <nav class="bg-[#1e40af] text-white p-4 shadow-lg flex justify-between items-center px-10 sticky top-0 z-50">
        <div class="flex items-center gap-3">
            <i class="fas fa-edit text-2xl"></i>
            <h1 class="text-xl font-black tracking-tight">PrepIQ Exam Engine</h1>
        </div>
        <div id="status" class="text-[10px] font-bold bg-white text-blue-800 px-3 py-1 rounded-full border border-blue-200 uppercase">
            Upload PDF to Sync Knowledge
        </div>
    </nav>

    <main class="container mx-auto mt-6 grid grid-cols-12 gap-6 p-4">
        
        <div class="col-span-3 space-y-4">
            <div class="bg-white p-5 rounded-xl shadow-sm border border-gray-200">
                <p class="text-[10px] font-bold text-gray-400 uppercase mb-3">Course Code</p>
                <div class="space-y-1" id="sub-list">
                    <button onclick="changeSub('CCS340')" class="w-full text-left p-3 text-sm active-sub">Cyber Security (CCS340)</button>
                    <button onclick="changeSub('CS3691')" class="w-full text-left p-3 text-sm border-b">Embedded & IoT (CS3691)</button>
                    <button onclick="changeSub('CCW331')" class="w-full text-left p-3 text-sm border-b">Business Analytics (CCW331)</button>
                </div>
            </div>

            <div class="bg-white p-5 rounded-xl shadow-sm border border-gray-200">
                <p class="text-[10px] font-bold text-gray-400 uppercase mb-3">Target Marks</p>
                <div class="flex gap-2">
                    <button onclick="setMarks(2)" id="m2" class="flex-1 border py-2 rounded-lg text-xs font-bold">2M</button>
                    <button onclick="setMarks(8)" id="m8" class="flex-1 border py-2 rounded-lg text-xs font-bold">8M</button>
                    <button onclick="setMarks(16)" id="m16" class="flex-1 border py-2 rounded-lg text-xs font-bold mark-active">16M</button>
                </div>
            </div>

            <div class="bg-white p-5 rounded-xl shadow-sm border border-gray-200">
                <label class="cursor-pointer block text-center p-6 border-2 border-dashed border-blue-100 bg-blue-50 rounded-xl hover:bg-blue-100">
                    <i class="fas fa-upload text-blue-600 mb-2"></i>
                    <p class="text-[11px] font-bold uppercase text-blue-900">Upload Unit PDFs</p>
                    <input type="file" id="pdf-input" class="hidden" accept="application/pdf" multiple>
                </label>
            </div>
        </div>

        <div class="col-span-9 flex flex-col h-[850px] bg-white rounded-2xl shadow-2xl border border-gray-200 overflow-hidden">
            <div id="answer-sheet" class="flex-1 overflow-y-auto p-12 exam-paper">
                <div id="empty-hint" class="h-full flex flex-col items-center justify-center text-gray-300">
                    <i class="fas fa-pen-alt text-7xl mb-4"></i>
                    <p class="text-xl font-bold uppercase tracking-widest">Question Paper Ready</p>
                </div>
                <div id="exam-output" class="hidden"></div>
            </div>

            <div class="p-6 bg-gray-50 border-t flex gap-4">
                <input id="user-q" type="text" placeholder="Enter question (e.g., Explain symmetric key cryptography)..." class="flex-1 bg-white border rounded-xl px-6 py-4 outline-none focus:ring-2 focus:ring-blue-500 text-sm shadow-inner">
                <button onclick="writeAnswer()" class="bg-[#1e40af] text-white px-10 py-4 rounded-xl font-black text-sm hover:shadow-xl transition-all">GENERATE ANSWER</button>
            </div>
        </div>
    </main>

    <script>
        let pdfDatabase = "";
        let selectedM = 16;
        let selectedS = "CCS340";
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js';

        // Load PDF Data
        document.getElementById('pdf-input').addEventListener('change', async (e) => {
            const files = e.target.files;
            pdfDatabase = "";
            document.getElementById('status').innerText = "Reading PDFs...";
            
            for(let f of files) {
                const buffer = await f.arrayBuffer();
                const pdf = await pdfjsLib.getDocument(buffer).promise;
                for(let i=1; i<=pdf.numPages; i++) {
                    const page = await pdf.getPage(i);
                    const content = await page.getTextContent();
                    pdfDatabase += content.items.map(s => s.str).join(" ") + " ";
                }
            }
            document.getElementById('status').className = "text-[10px] font-bold bg-green-500 text-white px-3 py-1 rounded-full uppercase";
            document.getElementById('status').innerText = "Knowledge Synced";
        });

        function setMarks(m) {
            selectedM = m;
            [2, 8, 16].forEach(v => document.getElementById('m'+v).classList.toggle('mark-active', v === m));
        }

        function changeSub(s) {
            selectedS = s;
            document.querySelectorAll('#sub-list button').forEach(b => b.classList.toggle('active-sub', b.innerText.includes(s)));
        }

        function writeAnswer() {
            const q = document.getElementById('user-q').value;
            if(!q || !pdfDatabase) { alert("Upload PDF first!"); return; }

            document.getElementById('empty-hint').classList.add('hidden');
            const target = document.getElementById('exam-output');
            target.classList.remove('hidden');
            target.innerHTML = `<p class="animate-pulse font-bold text-blue-800">Searching unit notes and writing answer...</p>`;

            setTimeout(() => {
                // Find real content snippets based on keywords
                const sentences = pdfDatabase.split(/[.!?]/).filter(s => s.trim().length > 10);
                const queryWords = q.toLowerCase().split(" ");
                let foundSentences = sentences.filter(s => queryWords.some(w => w.length > 4 && s.toLowerCase().includes(w)));
                
                // If no exact match, use context sentences
                if(foundSentences.length < 5) foundSentences = sentences.slice(0, 30);

                let content = `<h2 class="text-3xl font-black text-blue-900 border-b-4 border-blue-900 pb-2 mb-8">${q.toUpperCase()}</h2>`;

                if(selectedM == 2) {
                    content += `<div class="highlight-box">
                        <strong>Answer:</strong> ${foundSentences.slice(0, 3).join(". ")}.
                    </div>`;
                } else if(selectedM == 8) {
                    content += `
                        <span class="side-heading">1. Introduction</span>
                        <p>${foundSentences.slice(0, 4).join(". ")}.</p>
                        
                        <span class="side-heading">2. Detailed Explanation</span>
                        <p>${foundSentences.slice(4, 12).join(". ")}.</p>
                        
                        <span class="side-heading">3. Key Points & Applications</span>
                        <ul class="list-disc pl-5 mt-4 space-y-2">
                            <li>${foundSentences[12] || "Point 1: Discussed in unit notes"}</li>
                            <li>${foundSentences[13] || "Point 2: Technical implementation"}</li>
                            <li>${foundSentences[14] || "Point 3: Standard protocols"}</li>
                        </ul>`;
                } else {
                    content += `
                        <span class="side-heading">I. Introduction & Theoretical Background</span>
                        <p>${foundSentences.slice(0, 6).join(". ")}.</p>
                        
                        <span class="side-heading">II. Core Mechanism and Detailed Working</span>
                        <p>${foundSentences.slice(6, 18).join(". ")}.</p>
                        
                        <div class="my-10 p-10 border-4 border-double border-gray-300 bg-gray-50 text-center">
                            <p class="font-black text-xs uppercase tracking-widest text-gray-500 mb-2">Technical Diagram Requirement</p>
                            <div class="text-2xl font-serif text-blue-900 italic">[Diagram: ${q}]</div>
                            <p class="text-[10px] mt-2 italic">Student Note: Please draw the schematic found in Unit 2 for ${selectedS}.</p>
                        </div>
                        
                        <span class="side-heading">III. Features and Classification</span>
                        <p>${foundSentences.slice(18, 30).join(". ")}.</p>
                        
                        <span class="side-heading">IV. Conclusion</span>
                        <p class="italic text-gray-600">${foundSentences.slice(30, 34).join(". ")}.</p>`;
                }
                target.innerHTML = content;
                window.scrollBy({ top: 200, behavior: 'smooth' });
            }, 1000);
        }
    </script>
</body>
</html>
