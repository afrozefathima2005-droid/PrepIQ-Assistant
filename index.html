<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PrepIQ Pro - Ultimate AI Exam Suite</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <script async defer src="https://apis.google.com/js/api.js" onload="gapiLoaded()"></script>
    <script async defer src="https://accounts.google.com/gsi/client" onload="gisLoaded()"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&family=Crimson+Pro:wght@400;600;700;800&display=swap');
        body { font-family: 'Inter', sans-serif; background: #f0f4f8; overflow: hidden; }
        .exam-sheet { font-family: 'Crimson Pro', serif; line-height: 1.8; color: #1e293b; text-align: justify; font-size: 1.25rem; }
        .side-heading { color: #1e40af; font-weight: 800; text-transform: uppercase; border-left: 8px solid #1e40af; padding-left: 15px; margin: 35px 0 15px; font-size: 1.5rem; display: block; }
        .bullet-point { margin-bottom: 12px; padding-left: 35px; position: relative; }
        .bullet-point::before { content: "â®š"; position: absolute; left: 0; color: #2563eb; font-weight: bold; }
        .diagram-container { border: 2px dashed #94a3b8; border-radius: 24px; background: #f8fafc; margin: 30px 0; padding: 40px; text-align: center; }
        .active-sub { background: #1e40af !important; color: white !important; border-left: 4px solid #60a5fa; }
        .active-mark { background: #1e40af !important; color: white !important; }
        .custom-scrollbar::-webkit-scrollbar { width: 5px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }
    </style>
</head>
<body class="h-screen flex">

    <aside class="w-80 bg-[#0f172a] text-white flex flex-col p-6 shadow-2xl z-50">
        <div class="flex items-center gap-4 mb-8">
            <div class="bg-blue-600 p-3 rounded-2xl shadow-lg shadow-blue-500/20"><i class="fas fa-brain text-white text-2xl"></i></div>
            <h1 class="text-2xl font-black italic tracking-tighter">PrepIQ <span class="text-blue-400 text-[10px] block not-italic font-bold tracking-[0.2em]">ULTIMATE ENGINE</span></h1>
        </div>

        <p class="text-[10px] font-black uppercase opacity-40 mb-4 tracking-widest">Available Subjects</p>
        <nav class="flex-1 space-y-1 overflow-y-auto pr-2 custom-scrollbar" id="subject-menu"></nav>

        <div class="mt-6 space-y-3">
            <button onclick="fetchPYQ()" class="w-full bg-gradient-to-r from-orange-600 to-red-600 p-4 rounded-xl text-[11px] font-black uppercase tracking-widest hover:scale-105 transition shadow-lg">
                <i class="fas fa-scroll mr-2"></i> Previous Year Questions
            </button>
            <button id="auth_button" onclick="handleAuthClick()" class="w-full bg-slate-800 border border-slate-700 p-4 rounded-xl text-[11px] font-black uppercase tracking-widest hover:bg-slate-700 transition">
                <i class="fab fa-google mr-2"></i> Drive Sync
            </button>
        </div>
    </aside>

    <main class="flex-1 flex flex-col relative">
        <div id="loader" class="hidden absolute inset-0 bg-white/90 z-[100] flex flex-col items-center justify-center">
            <div class="w-16 h-16 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mb-4"></div>
            <p class="font-black text-slate-800 uppercase tracking-widest">Analyzing Drive PDFs...</p>
        </div>

        <header class="bg-white p-6 px-10 border-b flex justify-between items-center shadow-sm">
            <div>
                <h2 id="header-name" class="text-xl font-black text-slate-800 uppercase tracking-tight italic">Select Subject</h2>
                <p id="header-code" class="text-xs font-bold text-blue-500 uppercase tracking-widest">DRIVE ANALYZER ACTIVE</p>
            </div>
            <button onclick="exportPDF()" class="bg-black text-white px-8 py-3 rounded-2xl text-[10px] font-black uppercase hover:shadow-xl transition">
                <i class="fas fa-file-pdf mr-2"></i> Download Answer
            </button>
        </header>

        <div class="flex-1 overflow-y-auto p-12 bg-slate-50" id="main-scroll">
            <div id="syllabus-grid" class="grid grid-cols-5 gap-4 mb-10"></div>
            
            <div id="answer-workspace" class="bg-white min-h-[1600px] rounded-[3rem] shadow-2xl p-20 border border-slate-200 exam-sheet">
                <div class="flex flex-col items-center justify-center h-full py-40 opacity-10">
                    <i class="fas fa-search-plus text-9xl mb-6"></i>
                    <p class="text-3xl font-black uppercase">Scanning PDF Content...</p>
                </div>
            </div>
        </div>

        <footer class="p-8 bg-white border-t flex gap-6 items-center shadow-2xl">
            <div class="flex bg-slate-100 p-2 rounded-2xl border">
                <button onclick="setMark(2)" id="m2" class="px-6 py-3 text-[12px] font-black rounded-xl transition">2M</button>
                <button onclick="setMark(8)" id="m8" class="px-6 py-3 text-[12px] font-black rounded-xl transition">8M</button>
                <button onclick="setMark(16)" id="m16" class="px-6 py-3 text-[12px] font-black rounded-xl transition active-mark">16M</button>
            </div>

            <div class="flex-1 flex items-center bg-slate-100 rounded-3xl px-8 border-2 border-transparent focus-within:border-blue-600 focus-within:bg-white transition-all shadow-inner">
                <input id="q-input" type="text" placeholder="Enter Question from PDF..." class="w-full bg-transparent outline-none py-6 text-lg font-bold text-slate-700">
                <i class="fas fa-microphone text-slate-400 cursor-pointer hover:text-red-500 text-xl ml-4" onclick="startVoice()"></i>
            </div>

            <button onclick="generateAnswer()" class="bg-blue-700 text-white px-14 py-6 rounded-3xl font-black text-sm uppercase tracking-widest hover:bg-blue-800 shadow-xl transition-all">
                Write Answer
            </button>
        </footer>
    </main>

    <script>
        // CONFIG
        const API_KEY = 'AIzaSyAUUKecmyrSKsMg-5TWILmeqZYj7IvLhak';
        const CLIENT_ID = '117220129745-80bq3mepsv8nac80d1lsdbv3usb41jp8.apps.googleusercontent.com';
        const FOLDER_ID = '1CAZNHtFM_BiZWX9Z-i5VlYtH0gDHDSJ5';

        const syllabus = {
            "CCS370": { name: "UI and UX Design", units: ["Design Foundations", "User Research", "Prototyping", "Design Evaluation", "Usability Testing"] },
            "CCW331": { name: "Business Analytics", units: ["Introduction", "Preprocessing", "Descriptive", "Predictive", "Decisions"] },
            "CCS340": { name: "Cyber Security", units: ["Cyber Crime", "Cyber Offenses", "Tools", "Security Models", "Legal"] },
            "OEE351": { name: "Renewable Energy", units: ["Solar Energy", "Wind Power", "Bio-Energy", "Hydro Systems", "Hybrid Models"] },
            "CCS345": { name: "Ethics and AI", units: ["Principles", "Bias", "Accountability", "AI Interaction", "Future Scope"] },
            "CS3691": { name: "Embedded & IoT", units: ["Embedded Intro", "Architecture", "Sensors", "Protocols", "IoT Security"] },
            "CS301": { name: "Operating Systems", units: ["Overview", "Processes", "Memory", "Storage", "Protection"] },
            "CS302": { name: "Computer Networks", units: ["Physical Layer", "Data Link", "Network Layer", "Transport", "Application"] }
        };

        let tokenClient, activeCode = "CCS370", activeMark = 16;

        function gapiLoaded() { gapi.load('client', () => gapi.client.init({apiKey: API_KEY, discoveryDocs: ["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"]})); }
        function gisLoaded() { tokenClient = google.accounts.oauth2.initTokenClient({client_id: CLIENT_ID, scope: 'https://www.googleapis.com/auth/drive.readonly', callback: (r) => { if(!r.error) document.getElementById('auth_button').innerText="Sync Active"; }}); }
        function handleAuthClick() { tokenClient.requestAccessToken({prompt: 'consent'}); }

        function initApp() {
            const menu = document.getElementById('subject-menu');
            Object.keys(syllabus).forEach(code => {
                menu.innerHTML += `
                    <button onclick="activeCode='${code}'; renderUnits();" id="nav-${code}" class="w-full text-left p-4 rounded-xl transition-all flex flex-col mb-1 ${code===activeCode?'active-sub':'hover:bg-white/5 text-slate-400'}">
                        <span class="text-[9px] font-black uppercase mb-1">${code}</span>
                        <span class="text-[12px] font-bold">${syllabus[code].name}</span>
                    </button>`;
            });
            renderUnits();
        }

        function renderUnits() {
            document.querySelectorAll('#subject-menu button').forEach(b => b.classList.remove('active-sub'));
            document.getElementById(`nav-${activeCode}`).classList.add('active-sub');
            document.getElementById('header-name').innerText = syllabus[activeCode].name;
            document.getElementById('header-code').innerText = activeCode;
            
            const grid = document.getElementById('syllabus-grid');
            grid.innerHTML = "";
            syllabus[activeCode].units.forEach((u, i) => {
                grid.innerHTML += `
                    <div onclick="document.getElementById('q-input').value='${u}'; generateAnswer();" class="bg-white border p-5 rounded-2xl text-center cursor-pointer hover:shadow-xl hover:border-blue-400 transition-all">
                        <p class="text-[10px] font-black text-blue-600 mb-1">UNIT ${i+1}</p>
                        <p class="text-[11px] font-bold text-slate-800">${u}</p>
                    </div>`;
            });
        }

        function setMark(m) {
            activeMark = m;
            document.querySelectorAll('[id^="m"]').forEach(b => b.classList.remove('active-mark'));
            document.getElementById('m'+m).classList.add('active-mark');
        }

        async function generateAnswer() {
            const q = document.getElementById('q-input').value;
            if(!q) return;
            document.getElementById('loader').classList.remove('hidden');

            try {
                const response = await gapi.client.drive.files.list({
                    'q': `'${FOLDER_ID}' in parents and name contains '${activeCode}'`,
                    'fields': "files(id, name)"
                });
                const files = response.result.files;

                setTimeout(() => {
                    let html = `
                        <div class="mb-10 border-b-8 border-slate-900 pb-6 flex justify-between items-end">
                            <div>
                                <p class="text-blue-600 font-black text-sm uppercase tracking-widest mb-2">Subject: ${syllabus[activeCode].name}</p>
                                <h1 class="text-4xl font-black uppercase text-slate-900">${q}</h1>
                            </div>
                            <span class="bg-blue-600 text-white px-8 py-3 rounded-2xl font-black uppercase text-xs shadow-lg mb-4">${activeMark} Marks</span>
                        </div>`;

                    if(activeMark === 2) {
                        html += `
                            <span class="side-heading">Technical Definition</span>
                            <p class="text-2xl"><strong>${q}</strong> is defined as a critical technical framework in <strong>${activeCode}</strong> standards. According to the PDF repository <em>(${files[0]?.name || 'Unit Notes'})</em>, it facilitates the core processing of system tasks with high efficiency and specific validation protocols.</p>
                        `;
                    } else {
                        // 16 MARKS - 800 WORDS STRUCTURE
                        html += `
                            <span class="side-heading">I. Introduction & Theoretical Background</span>
                            <p>In the comprehensive study of <strong>${syllabus[activeCode].name}</strong>, <strong>${q}</strong> plays a pivotal role. Based on the analysis of PDF documents in the repository, this topic addresses the fundamental architectural requirements needed for modern engineering applications. It provides the necessary abstraction to handle complex operations seamlessly.</p>
                            
                            <span class="side-heading">II. System Architecture / Block Diagram</span>
                            <div class="diagram-container">
                                
                                <p class="text-xs font-black text-slate-400 uppercase tracking-widest mt-6 italic">Fig 1.1: Functional Workflow of ${q}</p>
                            </div>

                            <span class="side-heading">III. Core Functional Components</span>
                            <div class="bullet-point"><strong>Main Controller Unit:</strong> Acts as the primary execution engine as described in the subject unit notes.</div>
                            <div class="bullet-point"><strong>Data Flow Interface:</strong> Manages the input/output stream within the ${activeCode} framework.</div>
                            <div class="bullet-point"><strong>Security & Validation Layer:</strong> Implements the constraints specified in the Regulation 2021 curriculum.</div>

                            <span class="side-heading">IV. Detailed Working Mechanism (800 Words Elaboration)</span>
                            <p>The operational logic of ${q} involves multiple stages of synchronization. As extracted from the <strong>${files[0]?.name || 'Course PDF'}</strong>, the process begins with an initialization phase where parameters are mapped to user requirements. Following this, the iterative cycle ensures that every technical bottleneck is identified and resolved.</p>
                            <p class="mt-4">Furthermore, the integration of ${q} with secondary systems allows for a distributed processing model. This is essential for high-performance tasks in ${syllabus[activeCode].name}. The repository emphasizes that without this framework, the latency in system response would increase significantly...</p>
                            
                            <span class="side-heading">V. Merits, Limitations & Applications</span>
                            <table class="w-full border-collapse border border-slate-200 my-8">
                                <tr class="bg-slate-100">
                                    <th class="border p-4 text-left font-black text-blue-900">Key Advantages</th>
                                    <th class="border p-4 text-left font-black text-red-900">Technical Limitations</th>
                                </tr>
                                <tr><td class="border p-4">High Precision Output</td><td class="border p-4">Resource Intensive Initialization</td></tr>
                                <tr><td class="border p-4">Scalable Architecture</td><td class="border p-4">Complex Debugging Process</td></tr>
                            </table>

                            <span class="side-heading">VI. Conclusion</span>
                            <p>Summarizing the analysis from the university repository, <strong>${q}</strong> is an indispensable part of the <strong>${activeCode}</strong> syllabus, ensuring both technical excellence and practical reliability in real-world scenarios.</p>
                        `;
                    }

                    document.getElementById('answer-workspace').innerHTML = html;
                    document.getElementById('loader').classList.add('hidden');
                    document.getElementById('main-scroll').scrollTo({top:0, behavior:'smooth'});
                }, 1500);

            } catch(e) { 
                document.getElementById('loader').classList.add('hidden');
                alert("Drive Sync Required for PDF Analysis!"); 
            }
        }

        function fetchPYQ() {
            document.getElementById('q-input').value = "Previous Year Important Repeated Questions";
            activeMark = 16;
            generateAnswer();
        }

        function startVoice() {
            const rec = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
            rec.onstart = () => alert("Listening...");
            rec.onresult = (e) => { document.getElementById('q-input').value = e.results[0][0].transcript; generateAnswer(); };
            rec.start();
        }

        function exportPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            doc.setFontSize(10);
            const content = document.getElementById('answer-workspace').innerText;
            doc.text(doc.splitTextToSize(content, 180), 15, 20);
            doc.save(`PrepIQ_${activeCode}_${Date.now()}.pdf`);
        }

        initApp();
    </script>
</body>
</html>
