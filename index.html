<script>
    const syllabus = {
        "CCS370": { name: "UI and UX Design", units: ["Foundations of UI/UX", "User Research & Personas", "Design Principles & Layouts", "Prototyping & Interaction", "Usability Testing & Evaluation"] },
        "CCW331": { name: "Business Analytics", units: ["Introduction to BA", "Data Management", "Descriptive Analytics", "Predictive Modeling", "Decision Analytics"] },
        "CCS340": { name: "Cyber Security", units: ["Cyber Crime Overview", "Cyber Offenses", "Tools and Methods", "Security Protocols", "Legal Perspectives"] },
        "OEE351": { name: "Renewable Energy System", units: ["Solar Energy", "Wind Energy", "Bio-Energy", "Hydro Power", "Hybrid Systems"] },
        "CCS345": { name: "Ethics and AI", units: ["Moral Principles", "Algorithmic Bias", "AI Accountability", "Human-AI Interaction", "Future of AI Ethics"] },
        "CS3691": { name: "Embedded Systems & IoT", units: ["Embedded Intro", "IoT Architecture", "Sensors & Actuators", "Connectivity Protocols", "IoT Security"] }
    };

    let activeCode = "";
    let activeMark = 16;

    // Initialize Sidebar Menu
    const menu = document.getElementById('subject-menu');
    Object.keys(syllabus).forEach(code => {
        const btn = document.createElement('button');
        btn.className = "w-full text-left p-4 rounded-2xl hover:bg-white/10 transition flex flex-col";
        btn.id = `btn-${code}`;
        btn.innerHTML = `<span class="text-[8px] font-black opacity-40 mb-1">${code}</span><span class="text-[11px] font-bold">${syllabus[code].name}</span>`;
        btn.onclick = () => selectSub(code);
        menu.appendChild(btn);
    });

    function selectSub(code) {
        activeCode = code;
        document.querySelectorAll('#subject-menu button').forEach(b => b.classList.remove('active-sub'));
        document.getElementById(`btn-${code}`).classList.add('active-sub');
        document.getElementById('header-name').innerText = syllabus[code].name;
        document.getElementById('header-code').innerText = `Syncing Drive Data for ${code} | Regulation 2021`;

        const grid = document.getElementById('syllabus-grid');
        grid.innerHTML = "";
        syllabus[code].units.forEach((unit, i) => {
            grid.innerHTML += `
                <div class="unit-card" onclick="document.getElementById('q-input').value='Explain the concept of ${unit}'; generateFromDrive();">
                    <span class="pyq-tag">REPEATED 4X</span>
                    <p class="text-[10px] font-black text-blue-600 mb-2 uppercase">Unit ${i+1}</p>
                    <p class="text-[11px] font-black text-slate-800 leading-tight">${unit}</p>
                </div>`;
        });
    }

    function setMark(m) {
        activeMark = m;
        document.querySelectorAll('.mark-btn').forEach(b => b.classList.remove('active-sub'));
        document.getElementById('m'+m).classList.add('active-sub');
    }

    function generateFromDrive() {
        const q = document.getElementById('q-input').value;
        if(!q || !activeCode) {
            alert("Please select a subject and enter a question.");
            return;
        }
        
        const workspace = document.getElementById('answer-workspace');
        workspace.innerHTML = `<div class="animate-pulse py-20 text-center font-black text-blue-800 uppercase tracking-widest">Accessing Drive: 19fR12t1U... <br> Applying R2021 Evaluation Pattern...</div>`;

        // Simulated AI Logic following the requested 2M/8M/16M Structure
        setTimeout(() => {
            let html = `
                <div class="border-b-4 border-slate-900 pb-4 mb-8">
                    <h2 class="text-sm font-bold text-blue-600 uppercase tracking-widest">Anna University Regulation 2021 | ${activeCode}</h2>
                    <h1 class="text-3xl font-black text-slate-900 uppercase mt-2">Question: ${q}</h1>
                </div>

                <div class="mb-10">
                    <h2 class="text-xl font-black text-blue-800 border-b-2 border-blue-100 mb-4 uppercase tracking-tighter">2-Mark Answer</h2>
                    <p class="text-lg font-bold">${q.replace('Explain', '')} is a vital concept in ${syllabus[activeCode].name} that defines the fundamental parameters for system operation. It ensures technical compliance and optimized performance within the specified engineering constraints of the R2021 syllabus.</p>
                </div>

                <div class="mb-10">
                    <h2 class="text-xl font-black text-blue-800 border-b-2 border-blue-100 mb-4 uppercase tracking-tighter">8-Mark Answer</h2>
                    <div class="space-y-4">
                        <p class="font-bold">Structured Explanation:</p>
                        <div class="bullet-point"><strong>Functional Overview:</strong> The process begins with initialization where input parameters are verified against standard university benchmarks.</div>
                        <div class="bullet-point"><strong>Core Logic:</strong> It utilizes a tiered processing model to handle data flow, ensuring high throughput and low latency.</div>
                        <div class="bullet-point"><strong>Evaluation:</strong> Performance is monitored through feedback loops that adjust the control signals in real-time.</div>
                    </div>
                </div>

                <div class="mb-10">
                    <h2 class="text-xl font-black text-blue-800 border-b-2 border-blue-100 mb-4 uppercase tracking-tighter">16-Mark Answer</h2>
                    
                    <span class="side-heading">1. Introduction</span>
                    <p class="mb-6">As per the standard Anna University prescribed textbooks, <strong>${q}</strong> is categorized as a high-priority topic. It involves the integration of multiple subsystems to achieve a cohesive technical objective. In the current industrial landscape, this concept is fundamental for engineers working on ${syllabus[activeCode].name} projects.</p>

                    <span class="side-heading">2. Relevant Diagram</span>
                    <div class="bg-slate-50 border-2 border-dashed border-slate-300 p-8 rounded-xl font-mono text-[13px] my-6 overflow-x-auto text-slate-700">
+-----------------------+       +-----------------------+
|    Input Acquisition  | ----> |   Main Control Unit   |
| (Drive PDF Source)    |       |  (R2021 Logic Tier)   |
+-----------------------+       +-----------------------+
           ^                               |
           |                               V
+-----------------------+       +-----------------------+
|   Feedback/Analysis   | <---- |   Output Execution    |
| (Optimization Loop)   |       | (Final Result Module) |
+-----------------------+       +-----------------------+
                    </div>
                    <p class="text-center text-xs italic text-slate-400 mb-8">[Figure 1.1: Functional Architecture for ${q}]</p>

                    <span class="side-heading">3. Detailed Explanation</span>
                    <div class="bullet-point"><strong>Initialization Stage:</strong> The system identifies the specific outcomes defined in the unit syllabus and prepares the hardware/software nodes for execution.</div>
                    <div class="bullet-point"><strong>Processing Stage:</strong> Detailed algorithmic steps are carried out. For ${activeCode}, this involves high-precision data handling and validation against previous year paper benchmarks.</div>
                    <div class="bullet-point"><strong>Error Handling:</strong> Robust mechanisms are in place to detect deviations from the standard output, ensuring high marks for technical accuracy in examination.</div>

                    <span class="side-heading">4. Advantages & Applications</span>
                    <div class="bullet-point"><strong>Scalability:</strong> Can be expanded to larger industrial systems without loss of efficiency.</div>
                    <div class="bullet-point"><strong>Efficiency:</strong> Reduces manual intervention through automated processing as highlighted in the author notes.</div>
                    <div class="bullet-point"><strong>Industry Application:</strong> Widely used in modern automation, secure data transmission, and smart systems.</div>

                    <span class="side-heading">5. Conclusion</span>
                    <p class="font-bold italic mt-8 pt-4 border-t border-slate-100">In conclusion, a comprehensive mastery of ${q} ensures high exam-scoring quality and provides the student with the necessary technical depth required for professional roles in the field.</p>
                </div>
            `;
            workspace.innerHTML = html;
            workspace.scrollTop = 0;
        }, 1500);
    }

    function analyzeDrivePYQ() {
        const workspace = document.getElementById('answer-workspace');
        if(!activeCode) { alert("Select a subject first."); return; }
        workspace.innerHTML = `
            <h2 class="text-3xl font-black text-slate-800 border-b-8 border-blue-100 pb-4 mb-8 uppercase">Drive Intelligence: PYQ Trends (${activeCode})</h2>
            <div class="grid grid-cols-2 gap-6 mb-10">
                <div class="bg-blue-900 text-white p-8 rounded-3xl">
                    <p class="text-[10px] font-black text-blue-400 uppercase mb-3">Repeated 16M Topics (Regulation 2021)</p>
                    <ul class="text-sm space-y-2 font-bold italic">
                        <li>1. ${syllabus[activeCode]?.units[0]} (Nov 2023, May 2022)</li>
                        <li>2. ${syllabus[activeCode]?.units[2]} (Dec 2022, June 2023)</li>
                    </ul>
                </div>
                <div class="bg-white border-2 border-slate-100 p-8 rounded-3xl">
                    <p class="text-[10px] font-black text-slate-400 uppercase mb-3">Expected Questions (Nov 2024)</p>
                    <p class="text-sm text-slate-700 leading-relaxed">Based on Drive data analysis from folder 19fR12t1U..., Unit 4 and Unit 5 have the highest probability for Part-C questions this year.</p>
                </div>
            </div>
        `;
    }

    function voiceIn() {
        const rec = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
        rec.onstart = () => alert("Microphone listening... Speak your question.");
        rec.onresult = (e) => {
            document.getElementById('q-input').value = e.results[0][0].transcript;
            generateFromDrive();
        };
        rec.start();
    }

    function exportPDF() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        const text = document.getElementById('answer-workspace').innerText;
        doc.setFontSize(14);
        doc.text(`AU Exam Prep: ${activeCode}`, 15, 20);
        doc.setFontSize(10);
        doc.text(doc.splitTextToSize(text, 180), 15, 30);
        doc.save(`PrepIQ_R2021_${activeCode}.pdf`);
    }
</script>
